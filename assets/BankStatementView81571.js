import{A as G,J as le,C as ie,D as ce,E as ue,r as C,p as k,G as $,d as O,h as J,i as o,a as h,k as z,K as pe,T as H,s as j,o as W,c as S,w as c,u as de,b as v,f as _,e as r,n as R,t as x,v as V,g as me,j as X,R as K}from"../index81571.js";import{s as fe}from"./index81571.js";import{u as ve,T as I,_ as he,s as _e}from"./LazyDataTable.vue_vue_type_script_setup_true_lang81571.js";import{s as ye}from"./index815712.js";import{u as we}from"./useRole81571.js";import{u as Ee}from"./partner81571.js";class U{static async fetchInsurances(a){return await G("/insurances",a)}static async fetchInsuranceDetail(a,n){return await G(`/insurances/${a}`,n)}static async updateInsurance(a,n,u){return await le(`/insurances/${a}`,n)}static async createInsurance(a,n){return await ie("/insurances",a,n)}static async deleteInsurance(a){return await ce(`/insurances/${a}`)}}const ge=ue("insurance-store",()=>{const e=C([]),a=C(null),n=C(0),u=k(()=>n.value);async function p(f){const d=await U.fetchInsurances(f);e.value=d.insurances,n.value=d.total_records}async function w(f,d){a.value=null;const g=await U.fetchInsuranceDetail(f,d);a.value=g.insurance}async function E(f,d,g){const L=await U.updateInsurance(f,d,g);a.value=L.insurance}function A(){e.value=[],a.value=null,n.value=0}return{insurances:$(e),insurance:$(a),total_records:$(n),fetchInsurances:p,fetchInsuranceDetail:w,updateInsurance:E,totalInsurances:u,$reset:A}});var B=(e=>(e.CQS="cqs",e.CQP="cqp",e))(B||{}),l=(e=>(e.PENDING="pending",e.SUSPENDED="suspended",e.CANCELED="canceled",e.TO_PAY="to_pay",e.IN_PAYMENT="in_payment",e.POSTPONED="postponed",e.ANNULLED="annulled",e.PAID="paid",e.EXTINGUISHED_PREMATURELY="extinguished_prematurely",e.CLAIM="claim",e.REJECTED="rejected",e))(l||{});function be(){return Object.values(B)}function Y(e){return e===B.CQS?"CQS":"CQP"}function Pe(){return Object.values(l)}function N(e){switch(e){case l.PENDING:return"In attesa";case l.SUSPENDED:return"Sospesa";case l.CANCELED:return"Cancellata";case l.TO_PAY:return"Emessa/Da pagare";case l.IN_PAYMENT:return"In pagamento (questo mese)";case l.POSTPONED:return"Procrastinata";case l.ANNULLED:return"Annullata";case l.PAID:return"Pagata";case l.EXTINGUISHED_PREMATURELY:return"Estinta anticipatamente";case l.CLAIM:return"Sinistro";case l.REJECTED:return"Rifiutata"}}function Z(e){return`var(--insurance-status-${e}-color)`}const F=O({__name:"InsuranceStatusCircularIcon",props:{status:{},disableTooltip:{type:Boolean}},setup(e){const a=e,n=k(()=>Z(a.status)),u=k(()=>a.status===l.PENDING?"var(--p-black-400)":Z(a.status));return(p,w)=>{const E=H;return J((h(),z("div",{style:pe({backgroundColor:n.value,borderColor:u.value}),class:"size-[14px] rounded-full border-[1px] border-black-400"},null,4)),[[E,p.disableTooltip?null:o(N)(a.status)]])}}}),xe={class:"flex items-center gap-x-2"},Ie={class:"flex items-center gap-x-2"},Ne={class:"flex items-center gap-x-2"},Ce={class:"flex items-center min-h-[50px]"},De={key:0,class:"flex gap-2 items-center"},Te={class:"flex items-center justify-center"},q=10,Se=O({__name:"InsuranceTable",props:{partnerId:{}},setup(e){const a=e,n=de(),{isAdmin:u}=we(),p=ge(),w=Ee(),{allPartners:E}=j(w),{insurances:A,totalInsurances:f}=j(p),{onSort:d,onPage:g,loadLazyData:L,isLoading:ee,onFilter:te}=ve({rows:q},se),b=C(!1),D=C({id:{value:"",matchMode:I.EQ},partner_id:{value:"",matchMode:I.EQ},typology:{value:"",matchMode:I.LIKE},number:{value:"",matchMode:I.LIKE},status:{value:"",matchMode:I.EQ}});function Q(){te(D.value)}const ae=function(y){return{path:`${n.path}/${y}`}};async function se(y){try{await p.fetchInsurances(y)}catch(m){console.error(m)}}async function ne(){try{b.value=!0,await w.fetchPartners()}catch(y){console.error(y)}finally{b.value=!1}}return W(()=>{a.partnerId?(D.value.partner_id.value=a.partnerId,Q()):L(),u.value&&ne()}),(y,m)=>{const M=ye,T=X,P=_e,oe=fe,re=H;return h(),S(he,{value:o(A),rows:q,"total-records":o(f),onSort:o(d),onPage:o(g),onFilter:Q,filters:D.value,"onUpdate:filters":m[0]||(m[0]=t=>D.value=t),"data-key":"id",scrollable:"",loading:o(ee)},{empty:c(()=>m[2]||(m[2]=[v("Non ci sono polizze")])),default:c(()=>[a.partnerId?V("",!0):(h(),S(P,{key:0,class:"min-w-[150px]",header:"Partner",field:"partner_id",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!1},{filter:c(({filterModel:t,filterCallback:i})=>[_("div",xe,[r(M,{class:"w-[150px]",modelValue:t.value,"onUpdate:modelValue":[s=>t.value=s,i],options:o(E),"option-label":"name","option-value":"id",loading:b.value},{empty:c(()=>m[1]||(m[1]=[v("Non ci sono polizze")])),_:2},1032,["modelValue","onUpdate:modelValue","options","loading"]),r(T,{class:R(t.value?"":"invisible"),icon:"pi pi-filter-slash",variant:"text",rounded:"",onClick:s=>{t.value="",i()}},null,8,["class","onClick"])])]),body:c(({data:t})=>{var i;return[v(x((i=t.partner)==null?void 0:i.name),1)]}),_:1})),r(P,{style:{"min-width":"280px"},header:"Numero",field:"number",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!1},{filter:c(({filterModel:t,filterCallback:i})=>[r(oe,{modelValue:t.value,"onUpdate:modelValue":s=>t.value=s,type:"text",placeholder:"Filtra",onKeydown:me(s=>i(),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),r(P,{field:"typology",class:"min-w-[200px]",header:"Tipologia",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!1},{filter:c(({filterModel:t,filterCallback:i})=>[_("div",Ie,[r(M,{class:"w-[150px]",modelValue:t.value,"onUpdate:modelValue":[s=>t.value=s,i],options:o(be)(),"option-label":s=>o(Y)(s),loading:b.value},null,8,["modelValue","onUpdate:modelValue","options","option-label","loading"]),r(T,{class:R(t.value?"":"invisible"),icon:"pi pi-filter-slash",variant:"text",rounded:"",onClick:s=>{t.value="",i()}},null,8,["class","onClick"])])]),body:c(({data:t})=>[v(x(t.typology?o(Y)(t.typology):""),1)]),_:1}),r(P,{field:"status",class:"min-w-[200px]",header:"Stato",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!1},{filter:c(({filterModel:t,filterCallback:i})=>[_("div",Ne,[r(M,{class:"w-[200px]",modelValue:t.value,"onUpdate:modelValue":[s=>t.value=s,i],options:o(Pe)(),"option-label":s=>o(N)(s),loading:b.value},{value:c(({value:s})=>[_("div",Ce,[s?(h(),S(F,{key:0,class:"mr-4 flex-shrink-0",status:s},null,8,["status"])):V("",!0),v(" "+x(o(N)(s)),1)])]),option:c(({option:s})=>[s?(h(),S(F,{key:0,class:"mr-4",status:s},null,8,["status"])):V("",!0),v(" "+x(o(N)(s)),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","option-label","loading"]),r(T,{class:R(t.value?"":"invisible"),icon:"pi pi-filter-slash",variant:"text",rounded:"",onClick:s=>{t.value="",i()}},null,8,["class","onClick"])])]),body:c(({data:t})=>[t.status?(h(),z("div",De,[r(F,{status:t.status,disableTooltip:!0},null,8,["status"]),v(" "+x(o(N)(t.status)),1)])):V("",!0)]),_:1}),r(P,{class:"w-[50px]","align-frozen":"right",frozen:""},{body:c(({data:t})=>[_("div",Te,[J(r(T,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-arrow-right",text:"",rounded:"",as:"router-link",to:ae(t.id)},null,8,["to"]),[[re,"Modifica",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","total-records","onSort","onPage","filters","loading"])}}}),Ve={class:"flex flex-row items-baseline justify-between"},Ue=O({__name:"BankStatementView",props:{code:{}},setup(e){const a=k(()=>e.code?{name:K.POLIZZE_PARTNERS_NEW,params:{code:e.code}}:{name:K.POLIZZE_NEW});return W(()=>{}),(n,u)=>{const p=X;return h(),z("div",null,[_("div",Ve,[u[0]||(u[0]=_("h3",null,"Estratto conto",-1)),r(p,{label:"Crea estratto conto",size:"large",as:"router-link",to:a.value},null,8,["to"])]),r(Se,{"is-partner":!!n.code},null,8,["is-partner"])])}}});export{Ue as default};
