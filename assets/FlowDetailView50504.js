import{d as S,l as j,a as u,c as V,w as m,b as N,e as l,i as p,s as L,m as E,r as x,p as w,o as q,q as W,k as f,f as d,t as k,v as F,x as K,F as P,y,z as C,R as D,j as U,_ as G}from"../index50504.js";import{V as H,s as J,c as Q,a as X}from"./ValidateInputText50504.js";import{s as Y}from"./confirm-dialog50504.js";import{I as T,C as Z}from"./CustomCardForm50504.js";import{_ as ee}from"./AppBack.vue_vue_type_script_setup_true_lang50504.js";import{u as oe}from"./flow50504.js";import"./index50504.js";const te=S({__name:"FlowDataTab",setup(b){const t=j(T.FORM_VALIDATION);return(i,r)=>{const _=J;return u(),V(Z,null,{title:m(()=>r[0]||(r[0]=[N("Dati flusso")])),content:m(()=>[l(_,{class:"fluid-form-grid sm:grid-cols-3"},{default:m(()=>[l(H,{id:"code",name:"code",type:"text",label:"Codice*",detailMode:p(t)},null,8,["detailMode"])]),_:1})]),_:1})}}}),se={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4"},ae={class:"flex items-center gap-4"},le={key:0},ie={class:"flex flex-row items-stretch gap-2 ml-2"},re={key:0,class:"flex flex-row items-stretch gap-4"},ne={key:1,class:"flex flex-row items-stretch gap-4"},ce=S({__name:"FlowDetailView",props:{flow_id:{}},setup(b){const t=b,i=oe(),{currentFlow:r}=L(i),{resetForm:_,handleSubmit:I}=E({validationSchema:Q({code:X().required("Codice Ã¨ obbligatorio")}),initialValues:{code:""}}),s=x(!1),n=x(!1),c=w(()=>!t.flow_id),M=w(()=>c.value?"/flows":"/flows/"+t.flow_id),z=w(()=>c.value?"Flussi":"Pratiche");async function $(o){try{s.value=!0,await i.fetchFlowDetail(o),_({values:{...r.value}})}catch(e){console.error(e)}finally{s.value=!1}}async function O(o,e){try{s.value=!0,await i.updateFlow(o,e),y("Flusso aggiornato con successo"),n.value=!0}catch(a){console.error(a)}finally{s.value=!1}}async function A(o){var e;try{s.value=!0,await i.createFlow(o),(e=r.value)!=null&&e.id&&(y("Flusso creato con successo"),C.push({name:D.FLOWS}))}catch(a){console.error(a)}finally{s.value=!1}}async function B(o){try{await i.deleteFlow(o),y("Flusso eliminato con successo"),C.push({name:D.FLOWS})}catch(e){console.error(e)}}function R(){Y({message:"Stai per eliminare un flusso. Vuoi confermare l'operazione?",header:"Eliminazione flusso",acceptCallback(){t.flow_id&&B(t.flow_id)}})}const h=I(o=>{t.flow_id?O(t.flow_id,o):A(o)});return q(()=>{t.flow_id&&$(t.flow_id)}),W(T.FORM_VALIDATION,n),(o,e)=>{var g;const a=U;return u(),f(P,null,[l(ee,{title:z.value,url:M.value},null,8,["title","url"]),d("form",{onSubmit:e[2]||(e[2]=(...v)=>p(h)&&p(h)(...v))},[d("div",se,[d("div",ae,[d("h3",null,[N(k(c.value?"Nuovo flusso":"Dettaglio flusso")+" ",1),c.value?F("",!0):(u(),f("span",le," - "+k((g=p(r))==null?void 0:g.code),1))])]),d("div",ie,[l(K,{name:"fade",mode:"out-in"},{default:m(()=>[n.value?c.value?F("",!0):(u(),f("div",ne,[l(a,{class:"self-center",label:"Modifica",severity:"contrast",size:"small",variant:"outlined",rounded:"",onClick:e[1]||(e[1]=v=>n.value=!n.value)}),l(a,{class:"self-center",severity:"danger",size:"small",label:"Elimina",rounded:"",variant:"outlined",onClick:R})])):(u(),f("div",re,[c.value?F("",!0):(u(),V(a,{key:0,severity:"secondary",label:"Annulla","icon-pos":"right",size:"small",onClick:e[0]||(e[0]=v=>n.value=!0)})),l(a,{label:"Salva",type:"submit",size:"small",loading:s.value,disabled:s.value,"icon-pos":"right",rounded:""},null,8,["loading","disabled"])]))]),_:1})])]),l(te)],32)],64)}}}),we=G(ce,[["__scopeId","data-v-e40b02c4"]]);export{we as default};
