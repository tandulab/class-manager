import{o as P,F as B,D as N,c as M,a as R,m as i,l as D,_ as T,r as d,p as U,b as x,e as C,f as r,w as f,g as _,q as F,h as S,s as k,E as z,i as V,B as A}from"../index22191.js";import{u as K}from"./policy22191.js";import{e as O}from"./helpers22191.js";import{u as j}from"./sidebar22191.js";import{D as E,g as I,C as q}from"./formatData22191.js";import"./toast22191.js";const L={setup(){P(()=>{o.value=!0,l.value={first:0,rows:y.value.rows,sortField:null,sortOrder:null,filters:n.value},B.register("myfilter",(a,w)=>a===w),c()});const m=K();j();const t=N(),h=M(()=>m.response_policies),e=M(()=>m.policyRoles),p=R(),y=i(),u=i(),n=i({global:{value:null,matchMode:"contains"},full_name:{value:"",matchMode:"contains"},tax_code:{value:"",matchMode:"contains"},company_name:{value:"",matchMode:"contains"},enabled:{value:"",matchMode:"contains"},role:{value:"",matchMode:"contains"}}),o=i(!0),l=i(),b=i(0),v=i([{label:"Attivo",value:"true"},{label:"Disattivo",value:"false"}]),s=i([{label:"Utente",value:"policy"},{label:"Admin",value:"admin"}]),g=i([{label:"My Filter",value:"myfilter"}]);function c(){o.value=!0;const a=new Map;a.set("company_name",n.value.company_name.value),a.set("tax_code",n.value.tax_code.value),a.set("full_name",n.value.full_name.value),a.set("enabled",n.value.enabled.value),a.set("role",n.value.role.value),a.set("page",l.value.page+1),a.set("per_page",l.value.rows),l.value.sortField&&(l.value.sortOrder==1?a.set("sorted_by",l.value.sortField+"_asc"):a.set("sorted_by",l.value.sortField+"_desc")),setTimeout(()=>{Y(a)},Math.random()*1e3+250)}const Y=async function(a){await m.fetchAllPolicys(a).then(()=>{o.value=!1}).catch(w=>{o.value=!1,O(p,w)})};return{dt:y,responsePolicies:h,filters:n,loading:o,totalRecords:b,lazyParams:l,matchModes:g,policyRoles:e,status:v,roles:s,currentPolicy:u,onPage:a=>{l.value=a,c()},onSort:a=>{l.value=a,c()},onFilter:()=>{l.value.page=0,l.value.filters=n.value,c()},loadLazyData:c,goToDetail:function(a){t.path.includes("estratto-conto")?D.push({name:"partner-detail",params:{id:"234234",policy_id:a}}):D.push({name:"bank-statement-detail",params:{id:"234234",policy_id:a}})}}},components:{}};const G={class:"flex justify-content-between align-items-center"},H={class:"p-input-icon-left w-full mr-3 py-2"},J=_("i",{class:"pi pi-search"},null,-1);function Q(m,t,h,e,p,y){const u=d("InputText"),n=d("Button"),o=d("Column"),l=d("Dropdown"),b=d("DataTable"),v=U("tooltip");return x(),C("div",null,[r(b,{value:e.responsePolicies.policies,totalRecords:e.responsePolicies.total,lazy:!0,paginator:!0,rows:50,filters:e.filters,"onUpdate:filters":t[1]||(t[1]=s=>e.filters=s),ref:"dt",dataKey:"id",loading:e.loading,onPage:t[2]||(t[2]=s=>e.onPage(s)),onSort:t[3]||(t[3]=s=>e.onSort(s)),onFilter:t[4]||(t[4]=s=>e.onFilter()),filterDisplay:"row",removableSort:"",stripedRows:""},{header:f(()=>[_("div",G,[_("span",H,[J,r(u,{modelValue:e.filters.global.value,"onUpdate:modelValue":t[0]||(t[0]=s=>e.filters.global.value=s),placeholder:"Ricerca documento",class:"border-none w-full"},null,8,["modelValue"])]),_("div",null,[F(r(n,{icon:"pi pi-download",text:"",rounded:"","aria-label":"Dowload",size:"large"},null,512),[[v,"Scarica",void 0,{top:!0}]])])])]),empty:f(()=>[S(" Nessun documento trovato. ")]),default:f(()=>[r(o,{field:"company_name",header:"Nome file",filterMatchMode:"contains",ref:"company_name",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:f(({filterModel:s,filterCallback:g})=>[r(u,{type:"text",modelValue:s.value,"onUpdate:modelValue":c=>s.value=c,onKeydown:k(c=>g(),["enter"]),class:"p-column-filter",placeholder:"Filtra"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),r(o,{header:"Compagnia",filterMatchMode:"contains",ref:"role",field:"role",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:f(({filterModel:s,filterCallback:g})=>[r(l,{modelValue:s.value,"onUpdate:modelValue":c=>s.value=c,options:e.roles,optionValue:"value",optionLabel:"label",onChange:c=>g(),placeholder:"Filtra"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},512),r(o,{header:"Totale",field:"price"}),r(o,{header:"Data inserimento",field:"date"}),r(o,{header:"",style:{width:"5rem"}},{body:f(({data:s})=>[F(r(n,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"mr-0",icon:"pi pi-trash",text:"",rounded:""},null,512),[[v,"Edit",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading"])])}const W=T(L,[["render",Q]]),X={props:["policy_id","detail"],setup(){P(()=>{var n,o;const u=E.now();t.value=u.year+"",e.value=new Date(t.value,11,31),p.value=(o=(n=m.config)==null?void 0:n.locale)==null?void 0:o.monthNames});const m=z(),t=i(),h=i(),e=i(),p=i();return{currentYear:t,currentMonth:h,maxDate:e,getYearFromCalendar:I,selectMonth:function(u){var o,l;let n=u.index;p.value||(p.value=(l=(o=m.config)==null?void 0:o.locale)==null?void 0:l.monthNames),h.value=p.value[n]}}},components:{PaymentsTable:W,CalendarCard:q}},Z={class:"bank-statement"},$={class:"flex align-items-center justify-content-between flex-wrap mb-3"},ee=_("h1",null,"Pagamenti",-1),te={class:"flex align-items-center justify-content-center"},ae={key:0};function oe(m,t,h,e,p,y){const u=d("Calendar"),n=d("Button"),o=d("CalendarCard"),l=d("PaymentsTable"),b=d("Card");return x(),C("div",Z,[_("div",$,[ee,_("div",te,[r(u,{modelValue:e.currentYear,"onUpdate:modelValue":t[0]||(t[0]=v=>e.currentYear=v),view:"year",dateFormat:"yy",manualInput:!1,class:"mr-3 p-button-rounded",icon:"pi pi-chevron-right",maxDate:e.maxDate},null,8,["modelValue","maxDate"]),r(n,{label:"Carica quietanza",rounded:"",outlined:"",style:{"min-width":"169px"}})])]),r(o,{onTabClicked:t[1]||(t[1]=v=>e.selectMonth(v))}),r(b,{class:"custom-card-form"},{title:f(()=>[S(V(e.currentMonth)+" ",1),e.currentYear?(x(),C("span",ae,V(e.currentYear.length!=4?e.getYearFromCalendar(e.currentYear):e.currentYear),1)):A("",!0)]),content:f(()=>[r(l,{class:"mt-3"})]),_:1})])}const ve=T(X,[["render",oe]]);export{ve as default};
