import{V as I,s as U,a as W,b as X,c as Y,d as Z}from"./ValidateDropdown81571.js";import{A as z,B as ee,C as ae,D as te,E as ie,r as g,p as h,G as ce,d as q,l as oe,s as B,o as O,a as v,c as j,w as p,b as C,e as i,i as _,m as se,q as re,k as S,f as w,t as A,v as V,x as ne,F as le,y as F,z as E,R,j as ue,_ as de}from"../index81571.js";import{V as k,s as pe,c as me,a as $,b as fe}from"./ValidateInputText81571.js";import{s as _e}from"./confirm-dialog81571.js";import{I as L,C as ve}from"./CustomCardForm81571.js";import{_ as be}from"./AppBack.vue_vue_type_script_setup_true_lang81571.js";import{u as ye}from"./flow81571.js";import"./index815712.js";import"./index81571.js";class P{static async fetchPractices(e){return await z("/practices",e)}static async fetchPracticeDetail(e,a){return await z(`/practices/${e}`,a)}static async updatePractice(e,a,l){return await ee(`/practices/${e}`,a,l)}static async createPractice(e,a){return await ae("/practices",e,a)}static async deletePractice(e){await te(`/practices/${e}`)}}const we=ie("practice-store",()=>{const s=g(null),e=g([]),a=g(0),l=h(()=>a.value),b=h(()=>s.value);async function y(n){const u=await P.fetchPractices(n);e.value=u.practices,a.value=u.total_records,e.value.forEach(d=>{d.policy_premium=d.policy_premium/100})}async function r(n,u){s.value=null;const d=await P.fetchPracticeDetail(n,u);s.value=d.practice,s.value.policy_premium=s.value.policy_premium/100}async function o(n,u,d){const D=await P.updatePractice(n,u,d);s.value=D.practice}async function m(n,u){const d=await P.createPractice(n,u);s.value=d.practice}async function x(n){await P.deletePractice(n)}function M(){s.value=null,e.value=[],a.value=0}return{practices:ce(e),currentPractice:b,totalPractices:l,fetchPractices:y,fetchPracticeDetail:r,updatePractice:o,createPractice:m,deletePractice:x,$reset:M}}),Pe=q({__name:"PracticeDataTab",setup(s){const e=oe(L.FORM_VALIDATION),a=ye(),{flows:l}=B(a);O(async()=>{await a.fetchFlows()});const b=h(()=>l.value),y=h(()=>[{label:"Emessa",value:"e"},{label:"Sospesa",value:"x"}]);return(r,o)=>{const m=pe;return v(),j(ve,null,{title:p(()=>o[0]||(o[0]=[C("Dati")])),content:p(()=>[i(m,{class:"fluid-form-grid sm:grid-cols-3"},{default:p(()=>[i(I,{id:"flow_id",name:"flow_id",label:"Flusso*",options:b.value,"option-value":"id","option-label":"code",detailMode:!0},null,8,["options"]),i(k,{id:"financing_contract_number",name:"financing_contract_number",type:"text",label:"Contratto di finanziamento*",detailMode:_(e)},null,8,["detailMode"]),i(I,{id:"practice_status",name:"practice_status",label:"Stato pratica*",options:y.value,"option-value":"value","option-label":"label",detailMode:_(e)},null,8,["options","detailMode"]),i(k,{id:"policy_premium",name:"policy_premium",type:"number",label:"Premio*",detailMode:_(e)},{suffix:p(()=>o[1]||(o[1]=[C("€")])),_:1},8,["detailMode"]),i(k,{id:"subscription_number",name:"subscription_number",type:"text",label:"Conferma di adesione*",detailMode:_(e)},null,8,["detailMode"])]),_:1})]),_:1})}}}),ge={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4"},he={class:"flex items-center gap-4"},xe={key:0},De={class:"flex flex-row items-stretch gap-2 ml-2"},Se={key:0,class:"flex flex-row items-stretch gap-4"},$e={key:1,class:"flex flex-row items-stretch gap-4"},Ce=q({__name:"PracticeDetailView",props:{flow_id:{},id:{}},setup(s){const e=s,a=we(),{currentPractice:l}=B(a),{resetForm:b,handleSubmit:y}=se({validationSchema:me({flow_id:$().required("Flusso è obbligatorio"),financing_contract_number:$().required("Numero contratto è obbligatorio"),policy_premium:fe().required("Premio è obbligatorio"),practice_status:$().required("Stato pratica è obbligatorio"),subscription_number:$().required("Numero iscrizione è obbligatorio")}),initialValues:{flow_id:e.flow_id}}),r=g(!1),o=g(!!e.id),m=h(()=>!e.id);async function x(c){try{r.value=!0,await a.fetchPracticeDetail(c),b({values:{...l.value}})}catch(t){console.error(t)}finally{r.value=!1}}async function M(c,t){try{r.value=!0,await a.updatePractice(c,t),F("Pratica aggiornata con successo"),o.value=!0}catch(f){console.error(f)}finally{r.value=!1,x(c)}}async function n(c){var t;try{r.value=!0,await a.createPractice(c),(t=l.value)!=null&&t.id&&(F("Pratica creato con successo"),E.push({name:R.PRATICHE,params:{flow_id:e.flow_id,id:l.value.id}}))}catch(f){console.error(f)}finally{r.value=!1}}async function u(c){try{await a.deletePractice(c),F("Pratica eliminata con successo"),E.push({name:R.PRATICHE,params:{flow_id:e.flow_id}})}catch(t){console.error(t)}}function d(){_e({message:"Stai per eliminare una pratica. Vuoi confermare l'operazione?",header:"Eliminazione pratica",acceptCallback(){e.id&&u(e.id)}})}const D=y(async c=>{c.policy_premium=Math.round(Number(c.policy_premium)*100),e.id?await M(e.id,c):await n(c)});return O(()=>{e.id&&x(e.id)}),re(L.FORM_VALIDATION,o),(c,t)=>{var N;const f=ue,G=W,H=X,K=Y,J=Z,Q=U;return v(),S(le,null,[i(be,{title:"Pratiche",url:"/flows/"+e.flow_id},null,8,["url"]),w("form",{onSubmit:t[2]||(t[2]=(...T)=>_(D)&&_(D)(...T))},[w("div",ge,[w("div",he,[w("h3",null,[C(A(m.value?"Nuova pratica":"Dettagli pratica")+" ",1),m.value?V("",!0):(v(),S("span",xe," - "+A((N=_(l))==null?void 0:N.financing_contract_number),1))])]),w("div",De,[i(ne,{name:"fade",mode:"out-in"},{default:p(()=>[o.value?m.value?V("",!0):(v(),S("div",$e,[i(f,{class:"self-center",label:"Modifica",severity:"contrast",size:"small",variant:"outlined",rounded:"",onClick:t[1]||(t[1]=T=>o.value=!o.value)}),i(f,{class:"self-center",severity:"danger",size:"small",label:"Elimina",rounded:"",variant:"outlined",onClick:d})])):(v(),S("div",Se,[m.value?V("",!0):(v(),j(f,{key:0,severity:"secondary",label:"Annulla","icon-pos":"right",size:"small",onClick:t[0]||(t[0]=T=>o.value=!0)})),i(f,{label:"Salva",type:"submit",size:"small",loading:r.value,disabled:r.value,"icon-pos":"right",rounded:""},null,8,["loading","disabled"])]))]),_:1})])]),i(Q,{scrollable:"",value:"0"},{default:p(()=>[i(H,null,{default:p(()=>[i(G,{value:"0"},{default:p(()=>t[3]||(t[3]=[C("Dati pratica")])),_:1})]),_:1}),i(J,null,{default:p(()=>[i(K,{value:"0"},{default:p(()=>[i(Pe)]),_:1})]),_:1})]),_:1})],32)],64)}}}),Ee=de(Ce,[["__scopeId","data-v-85311967"]]);export{Ee as default};
