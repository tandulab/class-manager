import{V as F,a as Q,b as W,c as X,d as Z,e as ee}from"./ValidateDropdown91733.js";import{d as D,a1 as P,o as i,E as f,K as o,b as U,f as t,u as r,s as E,Y as te,a9 as O,a as v,e as b,c as w,a7 as ae,_ as A,a2 as R,aa as se,t as $,T as oe,a8 as C,aj as re,ab as le,y as ne,a0 as ie}from"../index91733.js";import{V,a as z,c as ce,b as h}from"./index.esm91733.js";import{I as k,C as L}from"./InjectionKeys91733.js";import{_ as ue,u as de}from"./RoleCard.vue_vue_type_script_setup_true_lang91733.js";import{u as me}from"./partner91733.js";import{u as pe}from"./useRole91733.js";import{s as _e}from"./confirm-dialog91733.js";import"./index917333.js";import"./index91733.js";import"./index917334.js";import"./index917335.js";const fe=D({__name:"UserDataCard",setup(y){const s=P(k.FORM_VALIDATION);return(l,p)=>{const _=z;return i(),f(L,null,{title:o(()=>p[0]||(p[0]=[U("Dati")])),content:o(()=>[t(_,{class:"fluid-form-grid sm:grid-cols-2"},{default:o(()=>[t(V,{id:"first_name",name:"first_name",type:"text",label:"Nome*",detailMode:r(s)},null,8,["detailMode"]),t(V,{id:"last_name",name:"last_name",type:"text",label:"Cognome*",detailMode:r(s)},null,8,["detailMode"]),t(V,{class:"sm:col-span-2",id:"email",name:"email",type:"email",label:"Email*",detailMode:r(s)},null,8,["detailMode"])]),_:1})]),_:1})}}}),ve={style:{"padding-block":"0.625rem","padding-inline":"0.25rem"}},be=D({__name:"UserRoleCard",setup(y){const s=me(),{allPartners:l}=E(s),{roles:p,isAdmin:_}=pe(),g=P(k.FORM_VALIDATION),{value:n}=te("role");async function u(){try{await s.fetchPartners()}catch(c){console.error(c)}}return O(()=>{_.value&&u()}),(c,m)=>{const T=z;return i(),f(L,null,{title:o(()=>m[0]||(m[0]=[U("Ruolo")])),content:o(()=>[t(T,{class:"fluid-form-grid sm:grid-cols-2"},{default:o(()=>[t(F,{id:"role",name:"role",label:"Ruolo","option-value":"value","option-label":"label",options:r(p),detailMode:r(g)},{detail:o(({data:x})=>[v("div",ve,[x.field?(i(),f(ue,{key:0,class:"max-w-[100px]",role:x.field},null,8,["role"])):b("",!0)])]),_:1},8,["options","detailMode"]),t(F,{id:"partner_id",name:"partner_id",label:"Partner","option-value":"id","option-label":"name",options:r(l),detailMode:r(g),disabled:r(n)=="admin"||!r(_)},null,8,["options","detailMode","disabled"])]),_:1})]),_:1})}}}),ye={class:"flex flex-col sm:flex-row gap-4"},ge=D({__name:"UserDataTab",setup(y){return(s,l)=>(i(),w("div",ye,[t(fe,{class:"sm:w-1/2"}),t(be,{class:"sm:w-1/2"})]))}}),xe={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4"},he={class:"flex items-center gap-4"},we={key:0},Ue={class:"flex flex-row items-stretch gap-2 ml-2"},De={key:0,class:"flex flex-row items-stretch gap-4"},Te=D({__name:"UserDetailView",props:{id:{},partnerId:{}},setup(y){const s=y,l=de(),{user:p}=E(l),{resetForm:_,handleSubmit:g}=ae({validationSchema:ce({email:h().email("L'email non è valida").required("Email è obbligatoria"),first_name:h().required("Nome è obbligatorio"),last_name:h().required("Cognome è obbligatorio"),partner_id:h().nullable().when("role",{is:a=>a==="user"||a==="partner",then:a=>a.required("Partner obbligatorio")})}),initialValues:{role:"user"}}),n=A(!1),u=A(!!s.id),c=R(()=>!s.id),m=R(()=>l.currentUser);async function T(a){try{n.value=!0,await l.fetchUserDetail(a),_({values:{...p.value}})}catch(e){console.error(e)}finally{n.value=!1}}async function x(a,e){try{n.value=!0,await l.updateUser(a,e),C("Utente aggiornato con successo"),u.value=!0}catch(d){console.error(d)}finally{n.value=!1}}async function q(a){var e;try{n.value=!0,await l.createUser(a),(e=m.value)!=null&&e.id&&(C("Utente creato con successo"),re.push({name:le.UTENTI_DETTAGLIO,params:{id:m.value.id}}))}catch(d){console.error(d)}finally{n.value=!1}}const I=g(a=>{c.value?q(a):x(s.id,a)});async function B(a){try{await l.deleteUser(a),C("Utente eliminato con successo")}catch(e){console.error(e)}}function j(){_e({message:"Stai per eliminare un utente. Vuoi confermare l'operazione?",header:"Eliminazione utente",acceptCallback(){s.id&&B(s.id)}})}return O(()=>{s.id&&T(s.id)}),se(k.FORM_VALIDATION,u),(a,e)=>{var N,S;const d=ne,K=W,G=X,Y=Z,H=ee,J=Q;return i(),w("form",{onSubmit:e[2]||(e[2]=(...M)=>r(I)&&r(I)(...M))},[v("div",xe,[v("div",he,[v("h1",null,[U($(c.value?"Nuovo utente":"Dettaglio utente")+" ",1),c.value?b("",!0):(i(),w("span",we," - "+$((N=m.value)==null?void 0:N.first_name)+" "+$((S=m.value)==null?void 0:S.last_name),1))])]),v("div",Ue,[t(oe,{name:"fade",mode:"out-in"},{default:o(()=>[u.value?c.value?b("",!0):(i(),f(d,{key:1,class:"self-center",size:"large",icon:"pi pi-pen-to-square",rounded:"",variant:"text",onClick:e[1]||(e[1]=M=>u.value=!u.value)})):(i(),w("div",De,[c.value?b("",!0):(i(),f(d,{key:0,severity:"secondary",label:"Annulla",size:"large","icon-pos":"right",style:{"min-width":"100px"},onClick:e[0]||(e[0]=M=>u.value=!0)})),t(d,{label:"Salva",size:"large",type:"submit",loading:n.value,disabled:n.value,"icon-pos":"right",style:{"min-width":"100px"}},null,8,["loading","disabled"])]))]),_:1}),c.value?b("",!0):(i(),f(d,{key:0,class:"self-center",severity:"danger",size:"large",icon:"pi pi-trash",rounded:"",variant:"text",onClick:j}))])]),t(J,{scrollable:"",value:"0"},{default:o(()=>[t(G,null,{default:o(()=>[t(K,{value:"0"},{default:o(()=>e[3]||(e[3]=[U("Dati utente")])),_:1})]),_:1}),t(H,null,{default:o(()=>[t(Y,{value:"0"},{default:o(()=>[t(ge)]),_:1})]),_:1})]),_:1})],32)}}}),Ee=ie(Te,[["__scopeId","data-v-cf1c7efa"]]);export{Ee as default};
