import{d as T,s as V,_ as C,a9 as Y,E as $,K as s,u as n,ac as z,o as v,b as f,a as u,f as t,F as b,e as I,t as d,O as P,M as Z,y as N,a3 as ee,a2 as te,c as S}from"../index14968.js";import{s as ae}from"./index14968.js";import{b as oe}from"./index149682.js";import{b as se}from"./index149683.js";import{T as i,u as ne,L as le}from"./LazyDataTable14968.js";import{u as B,_ as re}from"./RoleCard.vue_vue_type_script_setup_true_lang14968.js";import{u as D}from"./partner14968.js";import{u as ie}from"./useRole14968.js";import"./index149684.js";const ue={class:"flex items-center gap-x-2"},ce={class:"flex items-center gap-x-2"},de={class:"flex items-center gap-x-2"},pe={class:"flex items-center gap-x-2"},me={class:"flex items-center justify-center"},R=10,fe=T({__name:"UserTable",props:{partnerId:{}},setup(g){const r=g,h=B(),_=D(),{roles:w,isAdmin:x}=ie(),{users:k,totalUsers:M}=V(h),{allPartners:F}=V(_),U=C(!1),y=C({id:{value:"",matchMode:i.EQ},email:{value:"",matchMode:i.LIKE},role:{value:"",matchMode:i.EQ},first_name:{value:"",matchMode:i.LIKE},last_name:{value:"",matchMode:i.LIKE},partner_id:{value:"",matchMode:i.EQ},full_name:{value:"",matchMode:i.LIKE}}),O=z(),{onSort:Q,onPage:j,onFilter:A,loadLazyData:q,isLoading:G}=ne({rows:R},H);function E(){A(y.value)}async function H(c){try{await h.fetchUsers(c)}catch(l){console.error(l)}}async function J(){try{U.value=!0,await _.fetchPartners()}catch(c){console.error(c)}finally{U.value=!1}}const W=function(c){return{path:`${O.path}/${c}`}};return Y(()=>{r.partnerId?(y.value.partner_id.value=r.partnerId,E()):q(),x.value&&J()}),(c,l)=>{const K=se,p=N,m=oe,L=ae,X=ee;return v(),$(le,{value:n(k),rows:R,"total-records":n(M),onSort:n(Q),onPage:n(j),onFilter:E,filters:y.value,"onUpdate:filters":l[0]||(l[0]=e=>y.value=e),"data-key":"id",scrollable:"",loading:n(G)},{empty:s(()=>l[2]||(l[2]=[f("Non ci sono utenti")])),default:s(()=>[n(x)?(v(),$(m,{key:0,class:"min-w-[150px]",header:"Partner",field:"partner_id",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!1},{filter:s(({filterModel:e,filterCallback:a})=>[u("div",ue,[t(K,{class:"w-[150px]",modelValue:e.value,"onUpdate:modelValue":[o=>e.value=o,a],options:n(F),"option-label":"name","option-value":"id",loading:U.value,disabled:!!r.partnerId},{empty:s(()=>l[1]||(l[1]=[f("Non ci sono partner")])),_:2},1032,["modelValue","onUpdate:modelValue","options","loading","disabled"]),r.partnerId?I("",!0):(v(),$(p,{key:0,class:b(e.value?"":"invisible"),icon:"pi pi-filter-slash",variant:"text",rounded:"",onClick:o=>{e.value="",a()}},null,8,["class","onClick"]))])]),body:s(({data:e})=>{var a;return[f(d((a=e.partner)==null?void 0:a.name),1)]}),_:1})):I("",!0),t(m,{class:"min-w-[200px]",header:"Email",field:"email",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!1},{filter:s(({filterModel:e,filterCallback:a})=>[u("div",ce,[t(L,{fluid:"",modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,type:"text",placeholder:"Filtra",onKeydown:P(o=>a(),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeydown"]),t(p,{class:b(e.value?"":"invisible"),icon:"pi pi-filter-slash",variant:"text",rounded:"",onClick:o=>{e.value="",a()}},null,8,["class","onClick"])])]),_:1}),t(m,{class:"min-w-[200px]","filter-field":"full_name",header:"Nome",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!1},{filter:s(({filterModel:e,filterCallback:a})=>[u("div",de,[t(L,{fluid:"",modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,type:"text",placeholder:"Filtra",onKeydown:P(o=>a(),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeydown"]),t(p,{class:b(e.value?"":"invisible"),icon:"pi pi-filter-slash",variant:"text",rounded:"",onClick:o=>{e.value="",a()}},null,8,["class","onClick"])])]),body:s(({data:e})=>[f(d(e.first_name)+" "+d(e.last_name),1)]),_:1}),t(m,{class:"min-w-[100px]",header:"Ruolo",field:"role",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!1},{filter:s(({filterModel:e,filterCallback:a})=>[u("div",pe,[t(K,{class:"w-[100px]",modelValue:e.value,"onUpdate:modelValue":[o=>e.value=o,a],options:n(w),"option-label":"label","option-value":"value"},null,8,["modelValue","onUpdate:modelValue","options"]),t(p,{class:b(e.value?"":"invisible"),icon:"pi pi-filter-slash",variant:"text",rounded:"",onClick:o=>{e.value="",a()}},null,8,["class","onClick"])])]),body:s(({data:e})=>[t(re,{role:e.role},null,8,["role"])]),_:1}),t(m,{class:"w-[50px]","align-frozen":"right",frozen:""},{body:s(({data:e})=>[u("div",me,[Z(t(p,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-arrow-right",text:"",rounded:"",as:"router-link",to:W(e.id)},null,8,["to"]),[[X,"Modifica",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","total-records","onSort","onPage","filters","loading"])}}}),ve={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4"},he={key:0},$e=T({__name:"UsersView",props:{partnerId:{}},setup(g){const r=g,h=z(),_=te(()=>({path:`${h.path}/new`})),{total_records:w}=V(B()),{partnerRoute:x}=V(D());return(k,M)=>{const F=N;return v(),S("div",null,[u("div",ve,[u("h1",null,[f(d(n(w))+" "+d(n(w)==1?"Utente":"Utenti")+" ",1),r.partnerId?(v(),S("span",he," - Partner "+d(n(x).name),1)):I("",!0)]),t(F,{label:"Inserisci utente",size:"large",as:"router-link",to:_.value},null,8,["to"])]),t(fe,{"partner-id":r.partnerId},null,8,["partner-id"])])}}});export{$e as default};
