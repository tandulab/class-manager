import{d as S,s as b,r as C,o as W,c as y,w as s,i as n,u as X,a as d,b as h,f as i,e as a,n as x,v as V,t as p,g as E,h as Y,j as Z,T as ee,k as K,F as te}from"../index49648.js";import{s as ae}from"./index49648.js";import{T as u,u as oe,_ as se,s as ne}from"./LazyDataTable.vue_vue_type_script_setup_true_lang49648.js";import{s as le}from"./index496482.js";import{u as L,_ as re}from"./RoleCard.vue_vue_type_script_setup_true_lang49648.js";import{u as T}from"./partner49648.js";import{u as ie}from"./useRole49648.js";import{_ as ue}from"./AppBack.vue_vue_type_script_setup_true_lang49648.js";const ce={class:"flex items-center gap-x-2"},de={class:"flex items-center gap-x-2"},pe={class:"flex items-center gap-x-2"},me={class:"flex items-center gap-x-2"},fe={class:"flex items-center justify-center"},P=10,ve=S({__name:"UserTable",props:{partnerId:{}},setup(g){const l=g,m=L(),_=T(),{roles:$,isAdmin:F}=ie(),{users:N,totalUsers:R}=b(m),{allPartners:D}=b(_),U=C(!1),w=C({id:{value:"",matchMode:u.EQ},email:{value:"",matchMode:u.LIKE},role:{value:"",matchMode:u.EQ},first_name:{value:"",matchMode:u.LIKE},last_name:{value:"",matchMode:u.LIKE},partner_id:{value:"",matchMode:u.EQ},full_name:{value:"",matchMode:u.LIKE}}),z=X(),{onSort:B,onPage:O,onFilter:j,loadLazyData:Q,isLoading:A}=oe({rows:P},q);function k(){j(w.value)}async function q(c){try{await m.fetchUsers(c)}catch(r){console.error(r)}}async function G(){try{U.value=!0,await _.fetchPartners()}catch(c){console.error(c)}finally{U.value=!1}}const H=function(c){return{path:`${z.path}/${c}`}};return W(()=>{l.partnerId?(w.value.partner_id.value=l.partnerId,k()):Q(),F.value&&G()}),(c,r)=>{const I=le,f=Z,v=ne,M=ae,J=ee;return d(),y(se,{value:n(N),rows:P,"total-records":n(R),onSort:n(B),onPage:n(O),onFilter:k,filters:w.value,"onUpdate:filters":r[0]||(r[0]=e=>w.value=e),"data-key":"id",scrollable:"",loading:n(A)},{empty:s(()=>r[2]||(r[2]=[h("Non ci sono utenti")])),default:s(()=>[n(F)?(d(),y(v,{key:0,class:"min-w-[150px]",header:"Partner",field:"partner_id",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!1},{filter:s(({filterModel:e,filterCallback:t})=>[i("div",ce,[a(I,{class:"w-[150px]",modelValue:e.value,"onUpdate:modelValue":[o=>e.value=o,t],options:n(D),"option-label":"name","option-value":"id",loading:U.value,disabled:!!l.partnerId},{empty:s(()=>r[1]||(r[1]=[h("Non ci sono partner")])),_:2},1032,["modelValue","onUpdate:modelValue","options","loading","disabled"]),l.partnerId?V("",!0):(d(),y(f,{key:0,class:x(e.value?"":"invisible"),icon:"pi pi-filter-slash",variant:"text",rounded:"",onClick:o=>{e.value="",t()}},null,8,["class","onClick"]))])]),body:s(({data:e})=>{var t;return[h(p((t=e.partner)==null?void 0:t.name),1)]}),_:1})):V("",!0),a(v,{class:"min-w-[200px]",header:"Email",field:"email",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!1},{filter:s(({filterModel:e,filterCallback:t})=>[i("div",de,[a(M,{fluid:"",modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,type:"text",placeholder:"Filtra",onKeydown:E(o=>t(),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeydown"]),a(f,{class:x(e.value?"":"invisible"),icon:"pi pi-filter-slash",variant:"text",rounded:"",onClick:o=>{e.value="",t()}},null,8,["class","onClick"])])]),_:1}),a(v,{class:"min-w-[200px]","filter-field":"full_name",header:"Nome",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!1},{filter:s(({filterModel:e,filterCallback:t})=>[i("div",pe,[a(M,{fluid:"",modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,type:"text",placeholder:"Filtra",onKeydown:E(o=>t(),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeydown"]),a(f,{class:x(e.value?"":"invisible"),icon:"pi pi-filter-slash",variant:"text",rounded:"",onClick:o=>{e.value="",t()}},null,8,["class","onClick"])])]),body:s(({data:e})=>[h(p(e.first_name)+" "+p(e.last_name),1)]),_:1}),a(v,{class:"min-w-[100px]",header:"Ruolo",field:"role",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,"show-clear-button":!1},{filter:s(({filterModel:e,filterCallback:t})=>[i("div",me,[a(I,{class:"w-[100px]",modelValue:e.value,"onUpdate:modelValue":[o=>e.value=o,t],options:n($),"option-label":"label","option-value":"value"},null,8,["modelValue","onUpdate:modelValue","options"]),a(f,{class:x(e.value?"":"invisible"),icon:"pi pi-filter-slash",variant:"text",rounded:"",onClick:o=>{e.value="",t()}},null,8,["class","onClick"])])]),body:s(({data:e})=>[a(re,{role:e.role},null,8,["role"])]),_:1}),a(v,{class:"w-[50px]","align-frozen":"right",frozen:""},{body:s(({data:e})=>[i("div",fe,[Y(a(f,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",icon:"pi pi-arrow-right",text:"",rounded:"",as:"router-link",to:H(e.id)},null,8,["to"]),[[J,"Dettagli",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","total-records","onSort","onPage","filters","loading"])}}}),he={class:"flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4"},_e={key:0},$e=S({__name:"UsersView",props:{partnerId:{}},setup(g){const l=g,{total_records:m}=b(L()),{partnerRoute:_}=b(T());return($,F)=>(d(),K(te,null,[l.partnerId?(d(),y(ue,{key:0,title:"Utenti partner",url:"/utenti/partner"})):V("",!0),i("div",null,[i("div",he,[i("h3",null,[h(p(n(m))+" "+p(n(m)==1?"Utente":"Utenti")+" ",1),l.partnerId?(d(),K("span",_e," - Partner "+p(n(_).name),1)):V("",!0)])]),a(ve,{"partner-id":l.partnerId},null,8,["partner-id"])])],64))}});export{$e as default};
